#!/bin/bash

#
# Script para actualizar la aplicación web de LibreDTE
# @author Esteban De La Fuente Rubio, DeLaF (esteban[at]sasco.cl)
# @version 2017-01-21
#

WEBAPP=$(dirname $(cd $(dirname $0) && pwd))
cd $WEBAPP

echo "Actualizando aplicación web de LibreDTE"
git pull

echo "Actualizando composer"
cd $WEBAPP/website
composer install

echo "Actualizar submódulos de git"
cd $WEBAPP
for m in $(git config --file .gitmodules --get-regexp path | awk '{ print $2 }'); do
    if [ "$m" = "website/Module/Lce" ]; then
        git submodule deinit $m > /dev/null
        git rm $m > /dev/null
        rm -rf .git/modules/$m > /dev/null
    fi
done
git submodule foreach git pull origin master
